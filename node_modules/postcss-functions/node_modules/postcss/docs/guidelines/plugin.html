<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      # PostCSS Plugin GuidelinesA PostCSS plugin is a function that receives
      and, usually,transforms a CSS AST from the PostCSS parser.The rules below
      are *mandat...
    </title>
    <meta
      name="description"
      content="# PostCSS Plugin GuidelinesA PostCSS plugin is a function that receives and, usually,transforms a CSS AST from the PostCSS parser.The rules below are *mandat..."
    />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png" />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="/apple-icon-114x114.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="/apple-icon-120x120.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="144x144"
      href="/apple-icon-144x144.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="/apple-icon-152x152.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-icon-180x180.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/android-icon-192x192.png"
    />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="msapplication-TileColor" content="#90cdf4" />
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png" />
    <meta name="theme-color" content="#90cdf4" />

    <link
      rel="stylesheet"
      type="text/css"
      href="/pages/datashaman/sup.datashaman.com/styles/main.css"
    />
    <link
      rel="canonical"
      href="https://sup.datashaman.com/pages/datashaman/sup.datashaman.com/node_modules/postcss-functions/node_modules/postcss/docs/guidelines/plugin.html"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="sup"
      href="https://sup.datashaman.com/pages/datashaman/sup.datashaman.com/feed.xml"
    />
    <script src="/scripts/feather.min.js" defer></script>
    <script src="/scripts/main.js" defer></script>
  </head>

  <body class="bg-gray-300">
    <div class="container md:mx-auto p-4 md:flex">
      <aside class="flex-none md:w-56 text-center">
        <header
          class="bg-blue-300 text-4xl md:text-6xl p-2 mb-4 rounded shadow"
        >
          <h1><a href="/">sup</a></h1>
        </header>

        <div class="bg-yellow-300 text-base md:text-xl p-2 mb-4 rounded shadow">
          random thoughts.<br />pithy observations.<br />some gear-grinding.
        </div>

        <div class="bg-green-300 p-2 mb-4 md:mb-0 rounded shadow">
          <ul class="list-none">
            <li class="inline-block p-2">
              <a
                href="https://github.com/datashaman"
                target="_blank"
                rel="noopener noreferer"
                aria-label="github"
              >
                <i data-feather="github"></i>
              </a>
            </li>
            <li class="inline-block p-2">
              <a
                href="https://twitter.com/data_shaman"
                target="_blank"
                rel="noopener noreferer"
                aria-label="twitter"
              >
                <i data-feather="twitter"></i>
              </a>
            </li>
            <li class="inline-block p-2">
              <a
                href="/pages/datashaman/sup.datashaman.com/feed.xml"
                target="_blank"
                rel="noopener noreferer"
                aria-label="rss feed"
              >
                <i data-feather="rss"></i>
              </a>
            </li>
          </ul>
        </div>
      </aside>

      <section class="flex-grow md:px-4">
        <article class="bg-white p-4 mb-4 rounded shadow">
          <a
            href="/node_modules/postcss-functions/node_modules/postcss/docs/guidelines/plugin.html"
            ><h2>PostCSS Plugin Guidelines</h2></a
          >
          <hr />
          <h1 id="postcss-plugin-guidelines">PostCSS Plugin Guidelines</h1>

          <p>
            A PostCSS plugin is a function that receives and, usually,
            transforms a CSS AST from the PostCSS parser.
          </p>

          <p>The rules below are <em>mandatory</em> for all PostCSS plugins.</p>

          <p>
            See also
            <a
              href="http://blog.clojurewerkz.org/blog/2013/04/20/how-to-make-your-open-source-project-really-awesome/"
              >ClojureWerkz’s recommendations</a
            >
            for open source projects.
          </p>

          <h2 id="1-api">1. API</h2>

          <h3 id="11-clear-name-with-postcss--prefix">
            1.1 Clear name with
            <code class="highlighter-rouge">postcss-</code> prefix
          </h3>

          <p>
            The plugin’s purpose should be clear just by reading its name. If
            you wrote a transpiler for CSS 4 Custom Media,
            <code class="highlighter-rouge">postcss-custom-media</code>
            would be a good name. If you wrote a plugin to support mixins,
            <code class="highlighter-rouge">postcss-mixins</code> would be a
            good name.
          </p>

          <p>
            The prefix <code class="highlighter-rouge">postcss-</code> shows
            that the plugin is part of the PostCSS ecosystem.
          </p>

          <p>
            This rule is not mandatory for plugins that can run as independent
            tools, without the user necessarily knowing that it is powered by
            PostCSS — for example, <a href="http://cssnext.io/">cssnext</a> and
            <a href="https://github.com/postcss/autoprefixer">Autoprefixer</a>.
          </p>

          <h3 id="12-do-one-thing-and-do-it-well">
            1.2. Do one thing, and do it well
          </h3>

          <p>
            Do not create multitool plugins. Several small, one-purpose plugins
            bundled into a plugin pack is usually a better solution.
          </p>

          <p>
            For example, <a href="http://cssnext.io/">cssnext</a> contains many
            small plugins, one for each W3C specification. And
            <a href="https://github.com/ben-eb/cssnano">cssnano</a> contains a
            separate plugin for each of its optimization.
          </p>

          <h3 id="13-do-not-use-mixins">1.3. Do not use mixins</h3>

          <p>
            Preprocessors libraries like Compass provide an API with mixins.
          </p>

          <p>
            PostCSS plugins are different. A plugin cannot be just a set of
            mixins for
            <a href="https://github.com/postcss/postcss-mixins"
              >postcss-mixins</a
            >.
          </p>

          <p>
            To achieve your goal, consider transforming valid CSS or using
            custom at-rules and custom properties.
          </p>

          <h3 id="14-create-plugin-by-postcssplugin">
            1.4. Create plugin by
            <code class="highlighter-rouge">postcss.plugin</code>
          </h3>

          <p>
            By wrapping your function in this method, you are hooking into a
            common plugin API:
          </p>

          <div class="language-js highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"
              ><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">postcss</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="dl">'</span><span class="s1">plugin-name</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Plugin code</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre>
            </div>
          </div>

          <h2 id="2-processing">2. Processing</h2>

          <h3 id="21-plugin-must-be-tested">2.1. Plugin must be tested</h3>

          <p>
            A CI service like <a href="https://travis-ci.org/">Travis</a> is
            also recommended for testing code in different environments. You
            should test in (at least) Node.js
            <a href="https://github.com/nodejs/LTS">active LTS</a> and current
            stable version.
          </p>

          <h3 id="22-use-asynchronous-methods-whenever-possible">
            2.2. Use asynchronous methods whenever possible
          </h3>

          <p>
            For example, use
            <code class="highlighter-rouge">fs.writeFile</code> instead of
            <code class="highlighter-rouge">fs.writeFileSync</code>:
          </p>

          <div class="language-js highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"
              ><code><span class="nx">postcss</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="dl">'</span><span class="s1">plugin-sprite</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">sprite</span> <span class="o">=</span> <span class="nx">makeSprite</span><span class="p">();</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">file</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="k">return</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                <span class="nx">resolve</span><span class="p">();</span>
            <span class="p">})</span>
        <span class="p">});</span>

    <span class="p">};</span>
<span class="p">});</span>
</code></pre>
            </div>
          </div>

          <h3 id="23-set-nodesource-for-new-nodes">
            2.3. Set <code class="highlighter-rouge">node.source</code> for new
            nodes
          </h3>

          <p>
            Every node must have a relevant
            <code class="highlighter-rouge">source</code> so PostCSS can
            generate an accurate source map.
          </p>

          <p>
            So if you add new declaration based on some existing declaration,
            you should clone the existing declaration in order to save that
            original <code class="highlighter-rouge">source</code>.
          </p>

          <div class="language-js highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"
              ><code><span class="k">if</span> <span class="p">(</span> <span class="nx">needPrefix</span><span class="p">(</span><span class="nx">decl</span><span class="p">.</span><span class="nx">prop</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">decl</span><span class="p">.</span><span class="nx">cloneBefore</span><span class="p">({</span> <span class="na">prop</span><span class="p">:</span> <span class="dl">'</span><span class="s1">-webkit-</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">decl</span><span class="p">.</span><span class="nx">prop</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre>
            </div>
          </div>

          <p>
            You can also set
            <code class="highlighter-rouge">source</code> directly, copying from
            some existing node:
          </p>

          <div class="language-js highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"
              ><code><span class="k">if</span> <span class="p">(</span> <span class="nx">decl</span><span class="p">.</span><span class="nx">prop</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">animation</span><span class="dl">'</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keyframe</span> <span class="o">=</span> <span class="nx">createAnimationByName</span><span class="p">(</span><span class="nx">decl</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">keyframes</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">decl</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
    <span class="nx">decl</span><span class="p">.</span><span class="nx">root</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="nx">keyframes</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
            </div>
          </div>

          <h3 id="24-use-only-the-public-postcss-api">
            2.4. Use only the public PostCSS API
          </h3>

          <p>
            PostCSS plugins must not rely on undocumented properties or methods,
            which may be subject to change in any minor release. The public API
            is described in <a href="http://api.postcss.org/">API docs</a>.
          </p>

          <h2 id="3-errors">3. Errors</h2>

          <h3 id="31-use-nodeerror-on-css-relevant-errors">
            3.1. Use <code class="highlighter-rouge">node.error</code> on CSS
            relevant errors
          </h3>

          <p>
            If you have an error because of input CSS (like an unknown name in a
            mixin plugin) you should use
            <code class="highlighter-rouge">node.error</code> to create an error
            that includes source position:
          </p>

          <div class="language-js highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"
              ><code><span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">mixins</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">decl</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unknown mixin </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">name</span><span class="p">,</span> <span class="p">{</span> <span class="na">plugin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">postcss-mixins</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre>
            </div>
          </div>

          <h3 id="32-use-resultwarn-for-warnings">
            3.2. Use <code class="highlighter-rouge">result.warn</code> for
            warnings
          </h3>

          <p>
            Do not print warnings with
            <code class="highlighter-rouge">console.log</code> or
            <code class="highlighter-rouge">console.warn</code>, because some
            PostCSS runner may not allow console output.
          </p>

          <div class="language-js highlighter-rouge">
            <div class="highlight">
              <pre
                class="highlight"
              ><code><span class="k">if</span> <span class="p">(</span> <span class="nx">outdated</span><span class="p">(</span><span class="nx">decl</span><span class="p">.</span><span class="nx">prop</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">decl</span><span class="p">.</span><span class="nx">prop</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> is outdated</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">node</span><span class="p">:</span> <span class="nx">decl</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre>
            </div>
          </div>

          <p>
            If CSS input is a source of the warning, the plugin must set the
            <code class="highlighter-rouge">node</code> option.
          </p>

          <h2 id="4-documentation">4. Documentation</h2>

          <h3 id="41-document-your-plugin-in-english">
            4.1. Document your plugin in English
          </h3>

          <p>
            PostCSS plugins must have their
            <code class="highlighter-rouge">README.md</code> written in English.
            Do not be afraid of your English skills, as the open source
            community will fix your errors.
          </p>

          <p>
            Of course, you are welcome to write documentation in other
            languages; just name them appropriately (e.g.
            <code class="highlighter-rouge">README.ja.md</code>).
          </p>

          <h3 id="42-include-input-and-output-examples">
            4.2. Include input and output examples
          </h3>

          <p>
            The plugin’s <code class="highlighter-rouge">README.md</code> must
            contain example input and output CSS. A clear example is the best
            way to describe how your plugin works.
          </p>

          <p>
            The first section of the
            <code class="highlighter-rouge">README.md</code> is a good place to
            put examples. See
            <a href="https://github.com/iamvdo/postcss-opacity"
              >postcss-opacity</a
            >
            for an example.
          </p>

          <p>
            Of course, this guideline does not apply if your plugin does not
            transform the CSS.
          </p>

          <h3 id="43-maintain-a-changelog">4.3. Maintain a changelog</h3>

          <p>
            PostCSS plugins must describe the changes of all their releases in a
            separate file, such as
            <code class="highlighter-rouge">CHANGELOG.md</code>,
            <code class="highlighter-rouge">History.md</code>, or
            <a href="https://help.github.com/articles/creating-releases/"
              >GitHub Releases</a
            >. Visit
            <a href="http://keepachangelog.com/">Keep A Changelog</a> for more
            information about how to write one of these.
          </p>

          <p>
            Of course, you should be using
            <a href="http://semver.org/">SemVer</a>.
          </p>

          <h3 id="44-include-postcss-plugin-keyword-in-packagejson">
            4.4. Include
            <code class="highlighter-rouge">postcss-plugin</code> keyword in
            <code class="highlighter-rouge">package.json</code>
          </h3>

          <p>
            PostCSS plugins written for npm must have the
            <code class="highlighter-rouge">postcss-plugin</code> keyword in
            their <code class="highlighter-rouge">package.json</code>. This
            special keyword will be useful for feedback about the PostCSS
            ecosystem.
          </p>

          <p>
            For packages not published to npm, this is not mandatory, but is
            recommended if the package format can contain keywords.
          </p>
        </article>
      </section>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        feather.replace({
          width: 32,
          height: 32,
        });
      });
    </script>
  </body>
</html>
